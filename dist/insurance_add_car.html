<!DOCTYPE html>
<html lang="zh-cmn-Hans-CN">

<head>
    <meta charset="UTF-8">
    <!-- touch meta -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>车辆信息</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
    <link type="text/css" rel="stylesheet" href="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/css/slider.css?_r_t=1.0.0">
    <link type="text/css" rel="stylesheet" href="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/css/ch233.min.css?_r_t=1.0.0">
    <link type="text/css" rel="stylesheet" href="css/public.css?_r_t=1.0.0">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/store.js/1.3.20/store.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/handlebars.js/4.0.12/handlebars.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script type="text/javascript" src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/template-web.js"></script>
    <script type="text/javascript" src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/h5-slider.js"></script>
    <script type="text/javascript" src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/jweixin-1.4.0.js"></script>
    <script type="text/javascript" src="js/common.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/config.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/all-param.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/wechat-driver-login.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/regular.js?_r_t=1.0.0"></script>
</head>
<body>
<!--template-return公共样式-->
<div class="template-background">
    <div class="template-return" onclick="toInsurance()">
        <div class="head-logo">
            <img src="img/head-logo.png">
            <h5>智慧物流通</h5>
        </div>
        <div class="return-font">
            <p>进入首页</p>
            <img src="img/gp-btn.png">
        </div>
    </div>

    <!--新增车辆-->
    <form id="informationForm">
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">姓名</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="ownerName" placeholder="请输入车主姓名" value="" maxlength="64">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">身份证</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regIDCard" name="ownerIdentityId" placeholder="请输入身份证" value="" maxlength="18">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">手机号</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regPhone" name="ownerPhone" placeholder="请输入手机号" value="" maxlength="11">
                </div>
            </div>
        </div>
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车牌号码</label></div>
                <div class="weui-cell__bd">
                    <input type="hidden" name="id">
                    <input type="hidden" name="sourceType">
                    <input class="weui-input regCarNumber" name="carNumber" placeholder="请输入车牌号码" value="" maxlength="7">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车辆识别码</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regCaIDCard" name="carIdentifierCode" placeholder="请输入车辆识别码" value="" maxlength="17">
                </div>
            </div>
            <!--<div class="weui-cell">-->
                <!--<div class="weui-cell__hd"><label class="weui-label font-size">车辆行驶城市</label></div>-->
                <!--<div class="weui-cell__bd">-->
                    <!--<input class="weui-input" name="" placeholder="请输入车辆行驶城市" value="" maxlength="64">-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车辆品牌</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="" placeholder="请输入车辆品牌" value="" maxlength="64">
                </div>
            </div>-->
        </div>
        <!--<div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车辆注册日期</label></div>
                <div class="weui-cell__bd">
                    <input type="date" class="weui-input" name="" placeholder="请输入车辆注册日期" value="" maxlength="64">
                </div>
            </div>
        </div>--><!--暂时先去掉-->
    </form>
    <div class="weui-panel weui-panel_access" id="btn-click">
        <button class="weui-btn btn-orange">确认</button>
    </div>
</div>

<!--底部菜单栏-->
<div class="weui-tabbar btn-fixed">
    <a onclick="toInsurance()" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
            <img src="img/index.png" alt="">
        </div>
        <p class="weui-tabbar__label">主页</p>
    </a>
    <a onclick="toInsurancePriceList()" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
            <img src="img/product-list.png" alt="">
        </div>
        <p class="weui-tabbar__label">进度</p>
    </a>
    <a onclick="toInsuranceMy()" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
            <img src="img/driver-my.png" alt="">
        </div>
        <p class="weui-tabbar__label">我的</p>
    </a>
</div>
</body>
<script type="text/javascript">

    // 验证表单
    function validate() {
        return $("#informationForm").validate({
            rules: {
                ownerName: 'required', //车主姓名
                ownerIdentityId: 'required', //身份证
                    ownerPhone: { //手机号
                    required: true,
                    number: true
                },
                carNumber: { //车牌号
                    required: true,
                },
                carIdentifierCode: { //车架号
                    required: true,
                },
            },
            messages: {
                ownerName: {
                    required: '请填写车主姓名'
                },
                ownerIdentityId: {
                    required: '请填写身份证'
                },
                ownerPhone: {
                    required: '请填写手机号',
                    number: '手机号格式不正确'
                },
                carNumber: {
                    required: '请填写车牌号'
                },
                carIdentifierCode: {
                    required: '请填写车架号'
                }
            }
        });
    }
    //获取车辆id
    let carId = store.get(allParam.INSURANCE_CAR_ID);
    const urlCarId = config.getUrlParam(window.location.href, "id");
    $(function () {
        //判断是否有车辆id（修改操作）
        if (carId !=undefined && carId !='') {
            //查询车辆信息 并绑定
            getCarInfo(carId);
        }
        //判断是否是从消息中心点击出的请求
        if (urlCarId !=undefined && urlCarId !='') {
            //查询车辆信息 并绑定
            getCarInfo(urlCarId);
        }
    });

    //根据id查询车辆信息
    function getCarInfo(id) {
        config.$ajax({
            url: config.SERVICE_PATH + "/insurance/getCarInfoById",  //URL
            type: 'POST',
            dataType: 'json',
            data:{id:id},
            success: function (result) {
                if (result.success) {
                    //查询出数据  绑定数据
                    $(":input[name=ownerName]").val(result.data.ownerName);
                    $(":input[name=ownerIdentityId]").val(result.data.ownerIdentityId);
                    $(":input[name=ownerPhone]").val(result.data.ownerPhone);
                    $(":input[name=carNumber]").val(result.data.carNumber);
                    $(":input[name=carIdentifierCode]").val(result.data.carIdentifierCode);
                    $(":input[name=id]").val(result.data.id);
                    $(":input[name=sourceType]").val(result.data.sourceType);
                }
            }
        });
    }
    $("#btn-click").click(function () {
        $("#btn-click").attr("disabled", true);
        // return false;
        if (validate().form()) {
            $.ajax({
                type: "POST",//请求类型
                url: config.SERVICE_PATH + "/insurance/addOnlyCarInfo",  //URL
                data: $("#informationForm").serialize(),
                dataType: 'json',
                success: function (result) {
                    if (result.success) {
                        $.toptip("保存成功啦！", "success");
                        toInsuranceMyCar();
                    }else{
                        $("#btn-click").attr("disabled", false);
                        $.toptip(result.msg, "error");
                    }
                },
                error: function (result) {
                    $("#btn-click").attr("disabled", false);
                    $.toptip("保存失败，请退出公众号重试！！", "error");
                }
            });
        }
        return false;
    });
</script>
</html>