<!DOCTYPE html>
<html lang="zh-cmn-Hans-CN">

<head>
    <meta charset="UTF-8">
    <!-- touch meta -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>完善信息</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
    <link type="text/css" rel="stylesheet"
          href="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/css/slider.css?_r_t=1.0.0">
    <link type="text/css" rel="stylesheet"
          href="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/css/ch233.min.css?_r_t=1.0.0">
    <link type="text/css" rel="stylesheet" href="css/public.css?_r_t=1.0.0">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/store.js/1.3.20/store.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/handlebars.js/4.0.12/handlebars.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script type="text/javascript"
            src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/template-web.js"></script>
    <script type="text/javascript"
            src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/h5-slider.js"></script>
    <script type="text/javascript"
            src="https://web-js-css-1255861081.cos.ap-chengdu.myqcloud.com/js/jweixin-1.4.0.js"></script>
    <script type="text/javascript" src="js/common.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/config.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/all-param.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/wechat-driver-login.js?_r_t=1.0.0"></script>
    <script type="text/javascript" src="js/regular.js?_r_t=1.0.0"></script>
</head>
<body>
<!--template-background公共样式-->
<div class="template-background">
    <!--template-return公共样式-->
    <div class="template-return" onclick="toIndex()">
        <div class="head-logo">
            <img src="img/head-logo.png">
            <h5>智慧物流通</h5>
        </div>
        <div class="return-font">
            <p>进入首页</p>
            <img src="img/gp-btn.png">
        </div>
    </div>
</div>
<!--template-background公共样式-->
<div class="template-background padding-bottom-navigation-bar">
    <form id="informationForm">
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><h5 class="weui-label font-size">驾驶员信息<label class="red-font">*</label></h5>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">姓名</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="driverName" placeholder="请输入驾驶员姓名" value="" maxlength="64">
                    <input type="hidden" name="driverId">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">身份证</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regIDCard" name="driverIdentityId" placeholder="请输入身份证"
                           value="" maxlength="18">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="font-size weui-label">手机号</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input regPhone" name="driverMobile" placeholder="请输入手机号" value=""
                           maxlength="11">
                </div>
                <div class="weui-cell__bd">
                    <input type="button" class="verification-code" id="btn" value="获取验证码"/>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">验证码</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" id="validateName" name="validateName" maxlength="4" placeholder="请输入验证码">
                </div>
            </div>
        </div>
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><h5 class="weui-label font-size">车辆信息<label class="red-font">*</label></h5>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车牌号码</label></div>
                <div class="weui-cell__bd">
                    <input type="hidden" name="carId">
                    <input class="weui-input regCarNumber" name="carNumber" placeholder="请输入车牌号码" value=""
                           maxlength="7">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">车辆识别码</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regCaIDCard" name="carIdentifierCode" placeholder="请输入车辆识别码"
                           value=""
                           maxlength="17">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">所属公司</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="belongCompany" placeholder="请输入所属公司" value=""
                           maxlength="64">
                </div>
            </div>
        </div>
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><h5 class="weui-label font-size">账户信息</h5>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">收款人</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="accountName" placeholder="请输入收款人" value="" maxlength="64">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">银行卡号</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regBankNumber" name="bankCard" placeholder="请输入银行卡号" value=""
                           maxlength="25">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">开户行</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="bankName" placeholder="请输入开户行" value="" maxlength="64">
                </div>
            </div>
        </div>
        <div class="weui-cells weui-panel">
            <div class="weui-cell">
                <div class="weui-cell__hd"><h5 class="weui-label font-size">油卡信息</h5>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label font-size">油卡号</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input regOilCardNumber" name="oilCardNumber" placeholder="请输入油卡号最后7位数" value=""
                           maxlength="7">
                </div>
            </div>
        </div>
        <!--上传证件
        <div class="weui-gallery" id="gallery">
            <span class="weui-gallery__img" id="galleryImg"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i id="galleryDel" class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__hd">
                            <p class="weui-uploader__title font-size black-font my-font-weight">上传身份证正反面<label class="red-font">*</label></p>
                            <div class="weui-uploader__info"><span class="idCard">0</span>/2</div>
                        </div>
                        <ul class="weui-uploader__files" id="uploaderFiles" >

                        </ul>
                        <div class="weui-uploader__bd">
                            <div class="weui-uploader__input-box">
                                <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/*"
                                       multiple/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="weui-gallery" id="gallery1">
            <span class="weui-gallery__img" id="galleryImg1"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i id="galleryDel1" class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__hd">
                            <p class="weui-uploader__title font-size black-font my-font-weight">上传驾驶证<label class="red-font">*</label></p>
                            <div class="weui-uploader__info"><span class="driverCard">0</span>/2</div>
                        </div>
                        <ul class="weui-uploader__files" id="uploaderFiles1">

                        </ul>
                        <div class="weui-uploader__bd">
                            <div class="weui-uploader__input-box">
                                <input id="uploaderInput1" class="weui-uploader__input" type="file" accept="image/*"
                                       multiple/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="weui-gallery" id="gallery2">
            <span class="weui-gallery__img" id="galleryImg2"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i id="galleryDel2" class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__hd">
                            <p class="weui-uploader__title font-size black-font my-font-weight">上传行驶证<label class="red-font">*</label></p>
                            <div class="weui-uploader__info"><span class="travelCard">0</span>/2</div>
                        </div>
                        <ul class="weui-uploader__files" id="uploaderFiles2">

                        </ul>
                        <div class="weui-uploader__bd">
                            <div class="weui-uploader__input-box">
                                <input id="uploaderInput2" class="weui-uploader__input" type="file" accept="image/*"
                                       multiple/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->
    </form>
    <div class="weui-panel weui-panel_access" style="margin: 10px;">
        <button id="btn-disable" class="weui-btn weui-btn_warn">保存</button>
    </div>
</div>

</body>
<script>
    $(function () {
        // 验证是否登陆
        isLogin();
        // 查询信息绑定
        queryInformation();
    });

    // 修改完成后重新绑定 Sessionid  更新登陆信息
    $(document).on("click", "#btn-disable", function () {
        if (validate().form()) {
            //禁用按钮
            $("#btn-disable").addClass("weui-btn_disabled").text("提交中...");
            config.$ajax({
                type: "POST",
                url: config.SERVICE_PATH + "/weChatDriver/saveDriverUser",
                data: $("#informationForm").serialize(),
                dataType: 'json',
                success: function (result) {
                    if (result.success) {
                        if (!config.isEmpty(result.data)) {
                            store.remove(config.SESSIONID);
                            // 登录成功，缓存凭证
                            store.set(config.SESSION, result.data.sessionInfo);
                            store.set(config.SESSIONID, result.data.sessionInfo.id);
                            store.set(config.USER_KEY, result.data.userInfo);
                            store.set(config.SYS_INFO, result.data.sysInfo);
                            $.toptip("保存成功！", "success");
                            //跳转
                            toDriverMy();
                        }
                    } else {
                        $.toptip(result.msg, "error");
                    }
                    $("#btn-disable").removeClass("weui-btn_disabled").text("保存");
                },
                error: function (result) {
                    $.toptip("保存失败，请退出公众号重试！！", "error");
                }
            });
        }
        return false;
    });

    // 发送验证码
    $(document).on('click', '#btn', function () {
        var val = this;
        var phone = $(":input[name=driverMobile]").val();
        // 验证码是否正确
        if (config.isEmpty(phone)) {
            $.toptip("请输入手机号码！", "error");
            return false;
        }
        config.$ajax({
            url: config.SERVICE_PATH + "/weChatDriver/getValidate",  //URL
            type: 'POST',
            data: {'phone': phone},
            dataType: 'json',
            success: function (result) {
                console.log(result);
                if (result.success) {
                    //发送成功
                    $.toptip("验证码已发送，请注意查收！", "success");
                    settime(val);
                } else {
                    //发送失败
                    $.toptip("短信发送失败，请重试！", "error");
                }
            }
        });
    });

    // 短信验证码发送间隔
    var countdown = 60;
    function settime(val) {
        if (countdown == 0) {
            val.removeAttribute("disabled");
            val.value = "获取验证码";
            countdown = 60;

        } else {
            val.setAttribute("disabled", true);
            val.value = "重新发送(" + countdown + ")";
            countdown--;
            setTimeout(function () {
                settime(val);
            }, 1000)
        }
    }

    // 查询驾驶员信息回显
    function queryInformation() {
        config.$ajax({
            url: config.SERVICE_PATH + "/weChatDriver/queryByUpdate",  //URL
            type: 'POST',
            dataType: 'json',
            success: function (result) {
                if (result.success) {
                    $(":input[name=driverId]").val(result.data.driverId);
                    $(":input[name=driverName]").val(result.data.driverName);
                    $(":input[name=driverMobile]").val(result.data.driverMobile);
                    $(":input[name=driverIdentityId]").val(result.data.driverIdentityId);
                    $(":input[name=accountName]").val(result.data.accountName);
                    $(":input[name=bankCard]").val(result.data.bankCard);
                    $(":input[name=bankName]").val(result.data.bankName);
                    $(":input[name=carId]").val(result.data.carId);
                    $(":input[name=carNumber]").val(result.data.carNumber);
                    $(":input[name=belongCompany]").val(result.data.belongCompany);
                    $(":input[name=carIdentifierCode]").val(result.data.carIdentifierCode);
                    $(":input[name=oilCardNumber]").val(result.data.oilCardNumber);
                } else {
                    $.toptip(result.msg, "error");
                }
            }
        });
    }

    // 表单验证
    function validate() {
        return $("#informationForm").validate({
            rules: {
                driverName: 'required', //驾驶员姓名
                driverMobile: { //驾驶员电话
                    required: true,
                    number: true
                },
                driverIdentityId: 'required', //驾驶员身份证
                carNumber: 'required', //车牌号
                carIdentifierCode: 'required', //车辆识别代码
                validateName: 'required', //验证码
                oilCardNumber: {//油卡号
                    number: true
                },
            },
            messages: {
                driverName: {
                    required: '请填写驾驶员姓名'
                },
                driverMobile: {
                    required: '请填写驾驶员电话',
                    number: '电话格式不正确'
                },
                driverIdentityId: {
                    required: '请填写驾驶员身份证'
                },
                carNumber: {
                    required: '请填写车牌号'
                },
                carIdentifierCode: {
                    required: '请填写车辆识别代码'
                },
                validateName: {
                    required: '请输入验证码'
                },
                oilCardNumber: {
                    number: '油卡号格式不正确'
                }
            }
        });
    }
</script>
<!--上传-->
<!--<script>-->
<!--$(function () {-->
<!--var tmpl = '<li class="weui-uploader__file" style="background-image:url(#url#)"></li>',-->
<!--// 上传身份证-->
<!--$gallery = $("#gallery"),-->
<!--$galleryImg = $("#galleryImg"),-->
<!--$uploaderInput = $("#uploaderInput"),-->
<!--$uploaderFiles = $("#uploaderFiles");-->

<!--var length = $("#uploaderFiles li").length;-->
<!--$uploaderInput.on("change", function (e) {-->
<!--var src, url = window.URL || window.webkitURL || window.mozURL,-->
<!--files = e.target.files;-->
<!--for (var i = 0, len = files.length; i < len; ++i) {-->
<!--var file = files[i];-->

<!--if (url) {-->
<!--src = url.createObjectURL(file);-->
<!--} else {-->
<!--src = e.target.result;-->
<!--}-->
<!--// 将图片追加到ul中-->
<!--$uploaderFiles.append($(tmpl.replace('#url#', src)));-->
<!--length += 1;-->
<!--// 上传的图片数量-->
<!--$(".idCard").text(length);-->
<!--}-->
<!--// 判断ul下li的数量最大就不能上传-->
<!--if (length > 1) {-->
<!--$uploaderInput.parent().hide();-->
<!--}-->
<!--});-->
<!--$uploaderFiles.on("click", "li", function () {-->
<!--$galleryImg.attr("style", this.getAttribute("style"));-->
<!--$gallery.fadeIn(100);-->
<!--});-->
<!--$gallery.on("click", function () {-->
<!--$gallery.fadeOut(100);-->
<!--});-->

<!--// 删除-->
<!--$("#galleryDel").on('click', function () {-->
<!--var src = $(this).closest('.weui-gallery').find('span').attr('style'); //获取要删除的图片地址-->
<!--$(this).closest('.weui-gallery').next().children().find('ul>li[style="' + src + '"]').remove(); //删除图片-->
<!--length -= 1;-->
<!--// 上传的图片数量-->
<!--$(".idCard").text(length);-->
<!--// 判断ul下li的数量小于最大数量时显示-->
<!--if (length < 2) {-->
<!--$uploaderInput.parent().show();-->
<!--}-->
<!--});-->

<!--// 上传驾驶证-->
<!--$gallery1 = $("#gallery1"),-->
<!--$galleryImg1 = $("#galleryImg1"),-->
<!--$uploaderInput1 = $("#uploaderInput1"),-->
<!--$uploaderFiles1 = $("#uploaderFiles1");-->

<!--var length1 = $("#uploaderFiles1 li").length;-->
<!--$uploaderInput1.on("change", function (e) {-->
<!--var src, url = window.URL || window.webkitURL || window.mozURL,-->
<!--files = e.target.files;-->
<!--for (var i = 0, len = files.length; i < len; ++i) {-->
<!--var file = files[i];-->

<!--if (url) {-->
<!--src = url.createObjectURL(file);-->
<!--} else {-->
<!--src = e.target.result;-->
<!--}-->
<!--$uploaderFiles1.append($(tmpl.replace('#url#', src)));-->
<!--length1 += 1;-->
<!--$(".driverCard").text(length1);-->
<!--}-->
<!--if (length1 > 1) {-->
<!--$uploaderInput1.parent().hide();-->
<!--}-->
<!--});-->
<!--$uploaderFiles1.on("click", "li", function () {-->
<!--$galleryImg1.attr("style", this.getAttribute("style"));-->
<!--$gallery1.fadeIn(100);-->
<!--});-->
<!--$gallery1.on("click", function () {-->
<!--$gallery1.fadeOut(100);-->
<!--});-->
<!--// 删除-->
<!--$("#galleryDel1").on('click', function () {-->
<!--var src = $(this).closest('.weui-gallery').find('span').attr('style'); //获取要删除的图片地址-->
<!--$(this).closest('.weui-gallery').next().children().find('ul>li[style="' + src + '"]').remove(); //删除图片-->
<!--length1 -= 1;-->
<!--$(".driverCard").text(length1);-->
<!--if (length1 < 2) {-->
<!--$uploaderInput1.parent().show();-->
<!--}-->
<!--});-->

<!--// 上传行驶证-->
<!--$gallery2 = $("#gallery2"),-->
<!--$galleryImg2 = $("#galleryImg2"),-->
<!--$uploaderInput2 = $("#uploaderInput2"),-->
<!--$uploaderFiles2 = $("#uploaderFiles2");-->

<!--var length2 = $("#uploaderFiles2 li").length;-->
<!--$uploaderInput2.on("change", function (e) {-->
<!--var src, url = window.URL || window.webkitURL || window.mozURL,-->
<!--files = e.target.files;-->
<!--for (var i = 0, len = files.length; i < len; ++i) {-->
<!--var file = files[i];-->

<!--if (url) {-->
<!--src = url.createObjectURL(file);-->
<!--} else {-->
<!--src = e.target.result;-->
<!--}-->
<!--$uploaderFiles2.append($(tmpl.replace('#url#', src)));-->
<!--length2 += 1;-->
<!--$(".travelCard").text(length2);-->
<!--}-->
<!--if (length2 > 1) {-->
<!--$uploaderInput2.parent().hide();-->
<!--}-->
<!--});-->
<!--$uploaderFiles2.on("click", "li", function () {-->
<!--$galleryImg2.attr("style", this.getAttribute("style"));-->
<!--$gallery2.fadeIn(100);-->
<!--});-->
<!--$gallery2.on("click", function () {-->
<!--$gallery2.fadeOut(100);-->
<!--});-->
<!--// 删除-->
<!--$("#galleryDel2").on('click', function () {-->
<!--var src = $(this).closest('.weui-gallery').find('span').attr('style'); //获取要删除的图片地址-->
<!--$(this).closest('.weui-gallery').next().children().find('ul>li[style="' + src + '"]').remove(); //删除图片-->
<!--length2 -= 1;-->
<!--$(".travelCard").text(length2);-->
<!--if (length2 < 2) {-->
<!--$uploaderInput2.parent().show();-->
<!--}-->
<!--});-->
<!--});-->
<!--</script>-->
</html>